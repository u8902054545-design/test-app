<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Задачи</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --md-sys-color-surface: #1C1B1F;
            --md-sys-color-on-surface: #E6E1E5;
            --md-sys-color-surface-variant: #49454F;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-outline: #938F99;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            /* Защита от копирования */
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            overflow-x: hidden;
        }

        /* Material 3 Elevation & Interaction */
        .m3-card {
            background-color: #2b2930;
            transition: background-color 0.2s, transform 0.1s;
            position: relative;
            overflow: hidden;
        }

        .m3-card:active {
            background-color: #3b3842;
            transform: scale(0.98);
        }

        .m3-ripple {
            position: absolute;
            background: rgba(208, 188, 255, 0.12);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Скрытие полосы прокрутки */
        ::-webkit-scrollbar { width: 0; display: none; }
    </style>
</head>
<body class="antialiased">

    <!-- Material Top App Bar -->
    <header class="fixed top-0 left-0 w-full h-16 flex items-center px-4 z-50 bg-[#1C1B1F]/90 backdrop-blur-md border-b border-[#49454F]">
        <a href="https://u8902054545-design.github.io/DarkCenter-Cloud-User-Main/" 
           class="p-3 rounded-full hover:bg-[#49454F] transition-colors flex items-center justify-center text-[#E6E1E5]"
           id="backButtonLink">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        </a>
        <div class="ml-4">
            <h1 class="text-xl font-medium tracking-wide">Задачи</h1>
        </div>
    </header>

    <main class="pt-24 pb-8 px-4 max-w-md mx-auto">
        <div class="mb-6">
            <p class="text-sm font-medium text-[#D0BCFF] uppercase tracking-widest mb-1">Облачный центр</p>
            <h2 class="text-2xl font-normal text-[#E6E1E5]">Выберите действие</h2>
        </div>

        <div class="grid gap-3">
            <!-- Сборка -->
            <button class="m3-card w-full flex items-center p-5 rounded-[28px] shadow-sm text-left group" onclick="ripple(event); console.log('Сборка');">
                <div class="w-12 h-12 flex items-center justify-center bg-[#381E72] text-[#D0BCFF] rounded-2xl mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                </div>
                <div class="flex-1">
                    <span class="block text-lg font-medium text-[#E6E1E5]">Сборка</span>
                    <span class="text-xs text-[#CAC4D0]">Формирование новых заказов</span>
                </div>
                <svg class="text-[#938F99] group-hover:text-[#D0BCFF] transition-colors" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>

            <!-- Приёмка -->
            <button class="m3-card w-full flex items-center p-5 rounded-[28px] shadow-sm text-left group" onclick="ripple(event); console.log('Приёмка');">
                <div class="w-12 h-12 flex items-center justify-center bg-[#1E3A1E] text-[#B2F0B2] rounded-2xl mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                </div>
                <div class="flex-1">
                    <span class="block text-lg font-medium text-[#E6E1E5]">Приёмка</span>
                    <span class="text-xs text-[#CAC4D0]">Регистрация входящих грузов</span>
                </div>
                <svg class="text-[#938F99] group-hover:text-[#D0BCFF] transition-colors" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>

            <!-- Консолидация -->
            <button class="m3-card w-full flex items-center p-5 rounded-[28px] shadow-sm text-left group" onclick="ripple(event); console.log('Консолидация');">
                <div class="w-12 h-12 flex items-center justify-center bg-[#493500] text-[#FFDEA1] rounded-2xl mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="8" x="3" y="3" rx="1"/><rect width="8" height="8" x="13" y="3" rx="1"/><rect width="8" height="8" x="3" y="13" rx="1"/><path d="M17 17v4"/><path d="M21 17v4"/><path d="M17 17h4"/><path d="M17 21h4"/></svg>
                </div>
                <div class="flex-1">
                    <span class="block text-lg font-medium text-[#E6E1E5]">Консолидация</span>
                    <span class="text-xs text-[#CAC4D0]">Объединение отправлений</span>
                </div>
                <svg class="text-[#938F99] group-hover:text-[#D0BCFF] transition-colors" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>
    </main>

    <script>
        // 1. Ripple эффект для Material кнопок
        function ripple(event) {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            const rect = button.getBoundingClientRect();
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - rect.left - radius}px`;
            circle.style.top = `${event.clientY - rect.top - radius}px`;
            circle.classList.add("m3-ripple");

            const rippleInstance = button.getElementsByClassName("m3-ripple")[0];
            if (rippleInstance) rippleInstance.remove();
            button.appendChild(circle);
        }

        // 2. Защита от копирования и контекстного меню
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && (e.key === 'c' || e.key === 'u' || e.key === 's' || e.key === 'p' || e.key === 'a')) {
                e.preventDefault();
            }
            if (e.metaKey && (e.key === 'c' || e.key === 's')) { // Для Mac
                e.preventDefault();
            }
        });

        // 3. Логика проверки статуса
        const AUTH_URL = 'https://u8902054545-design.github.io/Auth-ITC-Platform/';
        const CLOSED_REDIRECT_URL = 'https://u8902054545-design.github.io/DarkCenter-Cloud-User-Main/';
        const API_ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbwq698UMNuC6B4XeEA3ZBZcLbgSKs3BviKUBroscGDvXPnV8ZdSg1voVC346i2VVbk1/exec';
        const CHECK_INTERVAL = 5000;

        async function checkShiftStatusAndRedirect() {
            const userEmail = localStorage.getItem('userEmail');
            if (!userEmail) {
                window.location.replace(AUTH_URL);
                return;
            }

            try {
                const response = await fetch(`${API_ENDPOINT_URL}?email=${encodeURIComponent(userEmail)}`, {
                    method: 'GET',
                    cache: 'no-cache'
                });
                if (!response.ok) throw new Error('Network error');
                const data = await response.json();

                if (data.action === 'auth_redirect') {
                    window.location.replace(AUTH_URL);
                    clearInterval(statusCheckInterval);
                    return;
                }

                const currentStatus = data.shift_status ? data.shift_status.trim() : '';
                if (currentStatus === 'Closed') {
                    window.location.replace(CLOSED_REDIRECT_URL);
                    clearInterval(statusCheckInterval);
                    return;
                }
            } catch (error) {
                console.error('Status check failed:', error);
            }
        }

        checkShiftStatusAndRedirect();
        const statusCheckInterval = setInterval(checkShiftStatusAndRedirect, CHECK_INTERVAL);
    </script>
</body>
</html>
