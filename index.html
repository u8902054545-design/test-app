<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- ИЗМЕНЕНИЕ: Жестко задаем ширину 1024px, чтобы эмулировать экран ПК -->
    <meta name="viewport" content="width=1024, user-scalable=yes">
    <title>Вход в Систему | Nexus Portal v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --easing-smooth: cubic-bezier(0.16, 1, 0.3, 1); /* Apple-like easing */
            --easing-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            /* Разрешаем скролл, если экран по вертикали меньше контента в режиме ПК */
            overflow-x: hidden; 
            min-width: 1024px; /* Гарантируем минимальную ширину для фона */
        }

        /* --- Background Animation --- */
        .bg-animate {
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #020617 100%);
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s ease-in-out infinite;
        }
        .orb-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #3b82f6; animation-delay: 0s; }
        .orb-2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: #a855f7; animation-delay: -5s; }
        .orb-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: #ef4444; animation-delay: -10s; opacity: 0.2; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, 50px); }
        }

        /* --- Main Card Container --- */
        #card-wrapper {
            transition: height 0.5s var(--easing-smooth);
            will-change: height;
            overflow: hidden;
            position: relative;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 0 0 1px rgba(0,0,0,0.2), 
                0 20px 40px -10px rgba(0,0,0,0.6);
        }

        /* --- Content Views Transitions --- */
        .view-section {
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transform: scale(0.96) translateY(10px);
            pointer-events: none;
            transition: 
                opacity 0.4s ease,
                transform 0.4s var(--easing-smooth);
            will-change: transform, opacity;
            padding: 2rem; /* Internal padding matches container */
        }

        .view-section.active {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: all;
            position: relative; /* Return to flow to calculate height */
            z-index: 10;
        }

        .view-section.inactive {
            position: absolute; /* Take out of flow */
            z-index: 0;
        }

        /* --- Interactive Elements --- */
        .role-card {
            transition: transform 0.3s var(--easing-bounce), background 0.2s ease, border-color 0.2s ease;
        }
        .role-card:hover {
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.03);
        }
        .role-card:active {
            transform: scale(0.98);
        }

        .custom-input {
            transition: all 0.2s ease;
            background: rgba(2, 6, 23, 0.4);
        }
        .custom-input:focus {
            background: rgba(2, 6, 23, 0.8);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* --- Loading Spinner --- */
        .spinner {
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- Toasts --- */
        #toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            pointer-events: none;
        }
        
        .toast {
            pointer-events: auto;
            transform-origin: top right;
            animation: toastIn 0.4s var(--easing-smooth);
        }
        .toast.hiding {
            animation: toastOut 0.3s var(--easing-smooth) forwards;
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(20px) scale(0.95); }
            to { opacity: 1; transform: translateX(0) scale(1); }
        }
        @keyframes toastOut {
            to { opacity: 0; transform: translateX(20px) scale(0.95); }
        }

        /* Font Utilities */
        .font-mono-code { font-family: 'JetBrains Mono', monospace; }
        
        /* Smooth Text Switch */
        .text-swap-container { position: relative; height: 1.5em; overflow: hidden; }
        .text-swap-inner { display: flex; flex-direction: column; transition: transform 0.4s var(--easing-smooth); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 text-slate-200">

    <!-- Ambient Background -->
    <div class="bg-animate">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Notification Container -->
    <div id="toast-container"></div>

    <div class="w-full max-w-[440px] relative z-10 flex flex-col gap-6">
        
        <!-- Header -->
        <div class="text-center relative">
            <div class="inline-flex items-center justify-center p-3 rounded-2xl bg-slate-900/30 border border-slate-700/30 shadow-xl backdrop-blur-md mb-3 ring-1 ring-white/10">
                <i data-lucide="layout-grid" class="w-8 h-8 text-white"></i>
            </div>
            <h1 class="text-3xl font-bold tracking-tight text-white drop-shadow-md">Nexus Portal</h1>
            <p class="text-slate-400 text-sm mt-2 font-medium">Secure Access Gateway</p>
        </div>

        <!-- MAIN CARD WRAPPER -->
        <!-- Logic: Wrapper animates height. Sections animate opacity/scale inside. -->
        <div id="card-wrapper" class="glass-panel rounded-3xl w-full">
            
            <!-- SECTION 1: ROLE SELECTION -->
            <div id="view-menu" class="view-section active">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-1">Выберите департамент</h2>
                
                <div class="space-y-3">
                    <!-- Developer -->
                    <button onclick="nav.toLogin('dev')" class="role-card w-full group flex items-center p-3.5 rounded-2xl border border-transparent hover:border-blue-500/20 cursor-pointer text-left">
                        <div class="flex-shrink-0 flex h-12 w-12 items-center justify-center rounded-xl bg-blue-500/10 text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-all duration-300">
                            <i data-lucide="terminal-square" class="w-6 h-6"></i>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-0.5">
                                <h3 class="font-semibold text-white text-base truncate">DevOps Core</h3>
                            </div>
                            <p class="text-xs text-slate-400 group-hover:text-slate-300 truncate transition-colors">CI/CD, Source Control</p>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-slate-600 group-hover:text-blue-400 transition-all transform group-hover:translate-x-1"></i>
                    </button>

                    <!-- Cloud AI -->
                    <button onclick="nav.toLogin('ai')" class="role-card w-full group flex items-center p-3.5 rounded-2xl border border-transparent hover:border-purple-500/20 cursor-pointer text-left">
                        <div class="flex-shrink-0 flex h-12 w-12 items-center justify-center rounded-xl bg-purple-500/10 text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition-all duration-300">
                            <i data-lucide="cpu" class="w-6 h-6"></i>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-0.5">
                                <h3 class="font-semibold text-white text-base truncate">Cloud AI</h3>
                            </div>
                            <p class="text-xs text-slate-400 group-hover:text-slate-300 truncate transition-colors">Neural Nets Dashboard</p>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-slate-600 group-hover:text-purple-400 transition-all transform group-hover:translate-x-1"></i>
                    </button>

                    <!-- DarkCenter -->
                    <button onclick="nav.toLogin('dark')" class="role-card w-full group flex items-center p-3.5 rounded-2xl border border-transparent hover:border-red-500/20 cursor-pointer text-left">
                        <div class="flex-shrink-0 flex h-12 w-12 items-center justify-center rounded-xl bg-red-500/10 text-red-500 group-hover:bg-red-600 group-hover:text-white transition-all duration-300">
                            <i data-lucide="fingerprint" class="w-6 h-6"></i>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-0.5">
                                <h3 class="font-semibold text-white text-base truncate">DarkCenter</h3>
                            </div>
                            <p class="text-xs text-slate-400 group-hover:text-slate-300 truncate transition-colors">Restricted Area</p>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-slate-600 group-hover:text-red-500 transition-all transform group-hover:translate-x-1"></i>
                    </button>
                </div>
                
                <div class="mt-6 pt-4 border-t border-slate-700/30 flex justify-center space-x-6 text-[11px] font-medium text-slate-500">
                    <a href="#" class="hover:text-slate-300 transition-colors">Documentation</a>
                    <a href="#" class="hover:text-slate-300 transition-colors">Support</a>
                </div>
            </div>

            <!-- SECTION 2: LOGIN FORM -->
            <div id="view-login" class="view-section inactive">
                <!-- Top Nav -->
                <div class="flex items-center justify-between mb-6">
                    <button onclick="nav.toMenu()" class="group flex items-center text-xs font-medium text-slate-400 hover:text-white transition-colors py-1">
                        <div class="p-1 rounded-md group-hover:bg-slate-800 transition-colors mr-1.5">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        </div>
                        Назад к выбору
                    </button>
                    
                    <!-- Dynamic Badge -->
                    <div id="role-badge" class="hidden opacity-0 scale-90 transition-all duration-300">
                        <span class="flex items-center gap-1.5 text-[10px] font-mono-code px-2 py-0.5 rounded border">
                            <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                            <span id="role-badge-text">ROLE</span>
                        </span>
                    </div>
                </div>

                <div class="mb-6">
                    <h2 id="login-title" class="text-xl font-bold text-white transition-colors duration-300">Вход</h2>
                    <p id="login-desc" class="text-xs text-slate-400 mt-1">Подтвердите личность для доступа</p>
                </div>

                <form onsubmit="handleLogin(event)" class="space-y-4">
                    
                    <!-- Input ID -->
                    <div class="group">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5 group-focus-within:text-slate-300 transition-colors">ID Пользователя</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i id="icon-user" data-lucide="user" class="h-4 w-4 text-slate-500 transition-colors duration-300"></i>
                            </div>
                            <input type="text" id="inp-id"
                                class="custom-input block w-full pl-9 pr-4 py-2.5 rounded-xl text-sm text-white placeholder-slate-600 focus:outline-none ring-1 ring-transparent focus:ring-white/10" 
                                placeholder="username">
                        </div>
                    </div>

                    <!-- Input Password -->
                    <div class="group">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5 group-focus-within:text-slate-300 transition-colors">Пароль</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i id="icon-lock" data-lucide="lock" class="h-4 w-4 text-slate-500 transition-colors duration-300"></i>
                            </div>
                            <input type="password" id="inp-pass"
                                class="custom-input block w-full pl-9 pr-10 py-2.5 rounded-xl text-sm text-white placeholder-slate-600 focus:outline-none ring-1 ring-transparent focus:ring-white/10 font-mono-code tracking-widest" 
                                placeholder="••••••••">
                            <button type="button" onclick="togglePass()" class="absolute inset-y-0 right-0 pr-3 flex items-center text-slate-600 hover:text-white cursor-pointer transition-colors focus:outline-none">
                                <i id="icon-eye" data-lucide="eye" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- DarkCenter 2FA -->
                    <div id="field-2fa" class="hidden overflow-hidden transition-all duration-300 max-h-0 opacity-0">
                        <label class="block text-[10px] font-bold text-red-400 uppercase tracking-widest mb-1.5 mt-2">Security Token</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-lucide="shield-check" class="h-4 w-4 text-red-500"></i>
                            </div>
                            <input type="text" id="inp-2fa"
                                class="custom-input block w-full pl-9 pr-4 py-2.5 rounded-xl text-sm text-red-100 placeholder-red-900/50 bg-red-950/20 focus:bg-red-950/40 focus:outline-none ring-1 ring-red-500/20 focus:ring-red-500/50 font-mono-code tracking-[0.3em]" 
                                placeholder="000-000">
                        </div>
                    </div>

                    <div class="flex items-center justify-between pt-2">
                        <label class="flex items-center space-x-2 cursor-pointer group select-none">
                            <div class="relative w-4 h-4 rounded bg-slate-800 border border-slate-700 group-hover:border-slate-500 transition-colors flex items-center justify-center">
                                <input type="checkbox" class="peer appearance-none absolute inset-0 w-full h-full cursor-pointer">
                                <i data-lucide="check" class="w-3 h-3 text-white opacity-0 peer-checked:opacity-100 transition-opacity"></i>
                            </div>
                            <span class="text-xs text-slate-400 group-hover:text-slate-300 transition-colors">Запомнить меня</span>
                        </label>
                    </div>

                    <button type="submit" id="btn-submit" 
                        class="w-full relative overflow-hidden group py-3 rounded-xl shadow-lg text-sm font-bold text-white transition-all transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 mt-2">
                        <div id="btn-bg" class="absolute inset-0 bg-blue-600 transition-all duration-500"></div>
                        <div class="absolute inset-0 bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div class="relative flex items-center justify-center gap-2" id="btn-content">
                            <span>Войти</span>
                            <i data-lucide="arrow-right" class="w-4 h-4 transition-transform group-hover:translate-x-1"></i>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-200" id="btn-loading">
                            <i data-lucide="loader-2" class="w-5 h-5 spinner"></i>
                        </div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="text-center">
            <p class="text-[10px] text-slate-600 uppercase tracking-widest font-semibold flex items-center justify-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                System Operational
            </p>
        </div>

    </div>

    <script>
        lucide.createIcons();

        // Configuration
        const roles = {
            dev: {
                title: 'Developer Access',
                desc: 'Corporate LDAP Authentication',
                color: 'blue',
                hex: '#3b82f6',
                badge: 'DEV_OPS'
            },
            ai: {
                title: 'Cloud AI Terminal',
                desc: 'Neural Network Control Interface',
                color: 'purple',
                hex: '#a855f7',
                badge: 'AI_RESEARCH'
            },
            dark: {
                title: 'DarkCenter Protocol',
                desc: 'Level 5 Security Clearance Required',
                color: 'red',
                hex: '#ef4444',
                badge: 'CLASSIFIED'
            }
        };

        // Navigation Controller
        const nav = {
            wrapper: document.getElementById('card-wrapper'),
            menu: document.getElementById('view-menu'),
            login: document.getElementById('view-login'),
            currentRole: null,

            // Utility to update height smoothly
            updateHeight: function(targetEl) {
                // To get the height of an absolute element, we temporarily make it relative/block offscreen or assume
                // simpler logic: We ensure the target element is "active" class logic handles visibility, 
                // but for height we can use scrollHeight if displayed.
                
                // Better trick: set heights.
                const menuHeight = this.menu.scrollHeight;
                // Temporarily make login display block but hidden to measure? 
                // Since we use the .active/.inactive class toggle, we can just measure after state change,
                // but that causes a jump.
                
                // FLIP approach for height:
                // 1. Get current height.
                const startHeight = this.wrapper.offsetHeight;
                
                // 2. Apply state change (make target visible in DOM flow to measure, but hidden visually)
                // Actually, our CSS keeps .inactive absolute (out of flow) and .active relative (in flow).
                // So switching the classes changes the wrapper's content height naturally.
                // We just need to explicitly set height to px to animate it.
                
                this.wrapper.style.height = startHeight + 'px';
                
                // Force reflow
                void this.wrapper.offsetHeight;
            },

            toLogin: function(role) {
                this.currentRole = role;
                const config = roles[role];
                
                // 1. Fix current height
                this.wrapper.style.height = this.wrapper.offsetHeight + 'px';

                // 2. Update Content
                this.updateTheme(config);
                
                // 3. Switch Classes (State)
                // Small delay to allow button ripple to finish
                setTimeout(() => {
                    this.menu.classList.remove('active');
                    this.menu.classList.add('inactive');
                    
                    this.login.classList.remove('inactive');
                    this.login.classList.add('active');

                    // 4. Measure new height and apply
                    // We need to wait for DOM to update styles from class change
                    const newHeight = this.login.scrollHeight; // + padding
                    this.wrapper.style.height = newHeight + 'px';

                    // 5. Cleanup height after transition
                    setTimeout(() => {
                        this.wrapper.style.height = null; // Auto
                        // Focus input
                        document.getElementById('inp-id').focus();
                    }, 500);

                }, 50);
            },

            toMenu: function() {
                // 1. Fix current height
                this.wrapper.style.height = this.wrapper.offsetHeight + 'px';
                
                // 2. Switch Classes
                this.login.classList.remove('active');
                this.login.classList.add('inactive');
                
                this.menu.classList.remove('inactive');
                this.menu.classList.add('active');
                
                // 3. Measure new height
                const newHeight = this.menu.scrollHeight;
                this.wrapper.style.height = newHeight + 'px';

                // 4. Cleanup
                setTimeout(() => {
                    this.wrapper.style.height = null;
                }, 500);
            },

            updateTheme: function(config) {
                const title = document.getElementById('login-title');
                const desc = document.getElementById('login-desc');
                const btnBg = document.getElementById('btn-bg');
                const badge = document.getElementById('role-badge');
                const badgeText = document.getElementById('role-badge-text');
                const iconUser = document.getElementById('icon-user');
                const iconLock = document.getElementById('icon-lock');
                const field2Fa = document.getElementById('field-2fa');

                // Update Text
                title.innerText = config.title;
                desc.innerText = config.desc;

                // Update Colors
                btnBg.className = `absolute inset-0 bg-${config.color}-600 transition-all duration-500`;
                
                // Update Badge
                badgeText.innerText = config.badge;
                badge.className = `hidden opacity-0 scale-90 transition-all duration-300 text-${config.color}-400 bg-${config.color}-900/20 border-${config.color}-500/30`;
                
                // Update Icons (add specific color class)
                iconUser.className = `h-4 w-4 transition-colors duration-300 text-slate-500 group-focus-within:text-${config.color}-400`;
                iconLock.className = `h-4 w-4 transition-colors duration-300 text-slate-500 group-focus-within:text-${config.color}-400`;

                // Handle Special Fields (DarkCenter)
                if (this.currentRole === 'dark') {
                    // Show 2FA
                    field2Fa.classList.remove('hidden');
                    // Small timeout to allow display:block to apply before animating opacity/height
                    requestAnimationFrame(() => {
                        field2Fa.style.maxHeight = '100px';
                        field2Fa.style.opacity = '1';
                        title.classList.add('text-red-500');
                    });
                    
                    badge.classList.remove('hidden');
                    setTimeout(() => { badge.classList.remove('opacity-0', 'scale-90'); }, 100);

                } else {
                    // Hide 2FA
                    field2Fa.style.maxHeight = '0px';
                    field2Fa.style.opacity = '0';
                    setTimeout(() => field2Fa.classList.add('hidden'), 300);
                    
                    title.classList.remove('text-red-500');
                    badge.classList.add('opacity-0', 'scale-90');
                    setTimeout(() => badge.classList.add('hidden'), 300);
                }
            }
        };

        // --- UX Features ---

        function togglePass() {
            const inp = document.getElementById('inp-pass');
            const icon = document.getElementById('icon-eye');
            if (inp.type === 'password') {
                inp.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                inp.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        }

        function handleLogin(e) {
            e.preventDefault();
            const btnContent = document.getElementById('btn-content');
            const btnLoading = document.getElementById('btn-loading');
            const btn = document.getElementById('btn-submit');

            // Loading State
            btn.disabled = true;
            btnContent.classList.add('opacity-0', 'translate-y-2');
            btnLoading.classList.remove('opacity-0');
            
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% success chance
                
                if (success) {
                    showToast('success', 'Доступ разрешен', 'Перенаправление в защищенный сектор...');
                    setTimeout(() => window.location.reload(), 2000);
                } else {
                    showToast('error', 'Ошибка авторизации', 'Неверный идентификатор или токен.');
                    
                    // Reset Button
                    btn.disabled = false;
                    btnContent.classList.remove('opacity-0', 'translate-y-2');
                    btnLoading.classList.add('opacity-0');
                    
                    // Shake Form
                    const wrapper = document.getElementById('card-wrapper');
                    wrapper.animate([
                        { transform: 'translateX(0)' },
                        { transform: 'translateX(-4px)' },
                        { transform: 'translateX(4px)' },
                        { transform: 'translateX(0)' }
                    ], { duration: 300 });
                }
            }, 1500);
        }

        // --- Toast System ---
        function showToast(type, title, msg) {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div');
            
            let colors = type === 'success' 
                ? 'bg-emerald-500/10 border-emerald-500/20 text-emerald-100' 
                : 'bg-red-500/10 border-red-500/20 text-red-100';
            
            let icon = type === 'success' ? 'check-circle-2' : 'alert-octagon';
            let iconColor = type === 'success' ? 'text-emerald-400' : 'text-red-400';

            el.className = `toast flex items-start w-72 p-4 rounded-2xl border backdrop-blur-xl shadow-2xl ${colors}`;
            el.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5 ${iconColor} mt-0.5 flex-shrink-0"></i>
                <div class="ml-3">
                    <h3 class="text-sm font-semibold">${title}</h3>
                    <p class="text-xs opacity-80 mt-1 leading-relaxed">${msg}</p>
                </div>
            `;
            
            container.appendChild(el);
            lucide.createIcons();
            
            setTimeout(() => {
                el.classList.add('hiding');
                el.addEventListener('animationend', () => el.remove());
            }, 3500);
        }

        // Init height
        // Optional: Pre-calculate heights if needed, but auto works fine with current logic
    </script>
</body>
                            </html>
